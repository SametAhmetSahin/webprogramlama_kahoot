<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<title>Sign Up | FitKoç</title>

    
<div id="messagemodal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Message</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick='$("#messagemodal").hide()'>
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="message"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick='$("#messagemodal").hide()'>Close</button>
        </div>
      </div>
    </div>
  </div>



<div class="card card-info">
<div class="card-header">
<h3 class="card-title">FitKoç Sign Up</h3>
</div>


<div class="form-horizontal">
<div class="card-body">
<div class="form-group row">
<label id="emaillabel" class="col-sm-2 col-form-label">Email</label>
<div class="col-sm-10">
<input type="email" class="form-control" id="email" placeholder="glavkoverkh@blackleague.omsk">
</div>
</div>

<!--
<div class="form-group row">
<label for="passwordlabel" class="col-sm-2 col-form-label">Password</label>
<div class="col-sm-10">
<input type="password" class="form-control" id="password" placeholder="GreatTrial1792">
</div>
</div>
-->

<div class="form-group row">
<label class="col-sm-2 col-form-label">Name</label>
<div class="col-sm-10">
<input class="form-control" id="name" placeholder="Dmitry Yazov">
</div>
</div>

<div class="form-group row">
<label class="col-sm-2 col-form-label">Phone Number</label>
<div class="col-sm-10">
<input type="tel" class="form-control" id="phonenumber" placeholder="05123456789">
</div>
</div>

<div class="form-group row">
  <label class="col-sm-2 col-form-label">Birth Date</label>
  <div class="col-sm-10">
    <input id="birthdate" type="date">
  </div>
</div>

<div class="form-group row">
  <label class="col-sm-2 col-form-label">Gender</label>
  <div class="col-sm-10">
    <select name="gender" id="gender">
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  </div>
</div>

<div class="form-group row">
  <label class="col-sm-2 col-form-label">Profile Picture</label>
  <div class="col-sm-10">
  <input type="file" class="form-control" id="file" accept="image/*">
  </div>
</div>
  


<div class="form-group row">
<div class="offset-sm-2 col-sm-10">
</div>
</div>
</div>

<div class="card-footer">
<button class="btn btn-primary" onclick="signup()" id="signupbutton">Sign up</button>
<button class="btn btn-secondary" onclick="window.location.replace(`login.html`)">Login</button>
</div>

</div>
</div>




<script src="common.js"></script>
<script>
/*
*/

    async  function signup() {

      var data = {}
      data["email"] = $("#email").val()
      //data["password"] = $("#password").val()
      data["name"] = $("#name").val()
      data["birthdate"] = $("#birthdate").val()
      data["phonenumber"] = $("#phonenumber").val()
      data["photoname"] = document.getElementById("file").files[0].name
      data["gender"] = $("#gender").val()

      if ([$("#email").val(), $("#name").val(), $("#birthdate").val(), $("#phonenumber").val(), $("#gender").val()].includes("")) {

        toggleElementClass("signupbutton", 3, "btn-primary", "btn-danger")
            $("#message").text("Empty fields in form.")
            $("#messagemodal").show()
        return
      }
      
      console.log(data)

      console.log(document.getElementById("file").files[0])

      var formData = new FormData();
      formData.append("file", document.getElementById("file").files[0], document.getElementById("file").files[0].name)

      console.log(formData)

      var respic = "";
      $.post({url: `${baseurl}/users/upload_profile_picture/`, async: false, processData:false, contentType:false, data: formData}, (data, status) => {respic = data})

      
      //respic = post_request("/users/upload_profile_picture/", formData)
        if (!respic) {
          toggleElementClass("signupbutton", 3, "btn-primary", "btn-danger")
            $("#message").text("Couldn't upload profile picture.")
            $("#messagemodal").show()
            return
        }
      
      res = post_request("/users/create/", data)
        if (res) {
            toggleElementClass("signupbutton", 3, "btn-primary", "btn-success")
            $("#message").text("You have successfully signed up. You will receive your password in your mail. You will be redirected to the login page in 15 seconds.")
            $("#messagemodal").show()
            await sleep(15000)
            console.log("login")
            window.location.replace(`login.html`)
        }
        else {
            toggleElementClass("signupbutton", 3, "bn-primary", "btn-danger")
            $("#message").text("Invalid data.")
            $("#messagemodal").show()

        }
    }

</script>

<!--
    
-->